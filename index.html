<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no, minimal-ui" />
  <title>RA educativa â€” Demo PC</title>

  <!-- LibrerÃ­as -->
 <script src="https://aframe.io/releases/1.7.1/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>


</head>
<body>
  <div id="hud">
    <span class="badge">RA educativa Â· multi-marcador</span>
    <button id="btnSnap">ğŸ“¸ Capturar</button>
    <button id="btnHelp">â“ Ayuda</button>
    <span style="margin-left:auto"></span>
    <span>Marcadores: <b>hiro</b> (yaguaretÃ©), <b>kanji</b> (carpincho)</span>
  </div>

  <div id="fallback">
    <div>
      <h2>Necesitamos acceso a la cÃ¡mara</h2>
      <p>Activalo y recargÃ¡ la pÃ¡gina. Si estÃ¡s en un aula virtual, abrÃ­ este recurso en una nueva pestaÃ±a.</p>
    </div>
  </div>

  <div id="msg">ApuntÃ¡ con la cÃ¡mara a los marcadores impresos: <b>hiro</b> y <b>kanji</b>.</div>
  <div class="legend">
    <div><b>hiro = â€œYasiâ€ (yaguaretÃ©)</b></div>
    <div><b>kanji = â€œCapyâ€ (carpincho)</b></div>
  </div>

  <!-- ESCENA -->
  <a-scene 
    vr-mode-ui="enabled: false"
    renderer="antialias: true; alpha: true; precision: mediump"
    embedded
    arjs="sourceType: webcam; debugUIEnabled: false; detectionMode: mono_and_matrix; matrixCodeType: 3x3;">
    
    <a-entity light="type: ambient; color: #BBB"></a-entity>
    <a-entity light="type: directional; color: #FFF; intensity: 0.6" position="0 1 1"></a-entity>

    <a-marker preset="hiro">
      <a-gltf-model src="assets/jaguar.glb" position="0 0 0" scale="0.5 0.5 0.5" rotation="0 180 0"></a-gltf-model>
      <a-entity position="0 1.2 0" text="value: Yasi Â· yaguaretÃ©; color: #fff; align: center; width: 2;"></a-entity>
    </a-marker>

    <a-marker preset="kanji">
      <a-gltf-model src="assets/capybara_low_poly.glb" position="0 0 0" scale="0.5 0.5 0.5" rotation="0 180 0"></a-gltf-model>
      <a-entity position="0 1.4 0" text="value: Capy Â· capibara; color: #fff; align: center; width: 2;"></a-entity>
    </a-marker>

    <a-entity camera></a-entity>
  </a-scene>

  <script>
    // PequeÃ±a ayuda
    document.getElementById('btnHelp').addEventListener('click', () => {
      alert('1) ImprimÃ­ los marcadores hiro y kanji.\n2) PermitÃ­ la cÃ¡mara.\n3) ApuntÃ¡ los marcadores.\n4) UsÃ¡ ğŸ“¸ para guardar una captura.');
    });

    // Captura
    document.getElementById('btnSnap').addEventListener('click', () => {
      try {
        const canvas = document.querySelector('canvas');
        const a = document.createElement('a');
        a.href = canvas.toDataURL('image/png');
        a.download = 'captura_ra.png';
        a.click();
      } catch (e) { alert('Error al capturar: ' + e.message); }
    });

// Ayuda interactiva
document.getElementById('btnHelp').addEventListener('click', () => {
  alert('1) ImprimÃ­ los marcadores hiro y kanji.\n2) PermitÃ­ la cÃ¡mara.\n3) ApuntÃ¡ los marcadores.\n4) UsÃ¡ ğŸ“¸ para guardar una captura.');
});

// Captura de pantalla
document.getElementById('btnSnap').addEventListener('click', () => {
  try {
    const canvas = document.querySelector('canvas');
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = 'captura_ra.png';
    a.click();
  } catch (e) {
    alert('Error al capturar: ' + e.message);
  }
});

// Activar cÃ¡mara manualmente si AR.js no lo hace
setTimeout(async () => {
  const video = document.querySelector('video');
  if (!video) {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ video: true });
      const v = document.createElement('video');
      v.setAttribute('autoplay', '');
      v.setAttribute('muted', '');
      v.setAttribute('playsinline', '');
      v.style.position = 'fixed';
      v.style.bottom = '10px';
      v.style.right = '10px';
      v.style.width = '160px';
      v.style.border = '2px solid #fff';
      v.style.zIndex = '999';
      v.srcObject = stream;
      document.body.appendChild(v);
      v.play();
      console.log('âœ… CÃ¡mara inicializada manualmente y agregada al DOM.');
    } catch (err) {
      document.getElementById('fallback').style.display = 'grid';
      document.getElementById('msg').textContent = 'No se pudo abrir la cÃ¡mara: ' + err.message;
    }
  }
}, 3000);

// Mostrar fallback si no aparece el video tras 10 s
setTimeout(() => {
  if (!document.querySelector('video')) {
    document.getElementById('fallback').style.display = 'grid';
  }
}, 10000);
</script>

</body>
</html>
